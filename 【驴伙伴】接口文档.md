# 【驴伙伴】接口文档
## 1. 空闲车 rent

- 页面自动加载空闲车信息： `/rent/list`

  - 前端请求： 在 `onLoad()` 中自动请求该接口

  - 后端返回： 

    ```json
    [
        {
            rentId //帖子id
            openId //发布者id
            nickName //发布者昵称
            gender //性别 0：女 1：男
            avatarUrl //发布者头像
            area //发布者宿舍区：韵苑
    		areaNum //发布者楼栋：16栋（传数字）
            weixin //微信号
            message //备注
            money //租车赏金
            carImage //车辆图片
            manned //0:可载人 1：不可 2：不限
            rentTime:[
            			{
            				week //求租周几： 1->周一,2-->周二
            				beginTime //求租的开始时间 hh:mm
            				endTime //求租的结束时间
        				}	
            		  ]
            time //创建或修改时间（备注： 显示：1小时前，传值：时间戳）
    		rent //1：发布展示 2：发布未展示
        }
    ]
    ```

- 车辆筛选： `/rent/select`

  - 前端请求：

    ```json
    {
        //租车地点
        area //宿舍区
        areaNum //楼栋
        //租车时段
        week //周几: 1->周一,2-->周二
        //是否可载人
        manned //0:可载人 1：不可 2：不限
        //车主性别
        gender //0:女 1：男
    }
    ```

  - 后端返回：

    ```json
    [
        {
            rentId //帖子id
            openId //发布者id
            nickName //发布者昵称
            gender //性别 0：女 1：男
            avatarUrl //发布者头像
            area //发布者宿舍区：韵苑
    		areaNum //发布者楼栋：16栋（传数字）
            weixin //微信号
            message //备注
            money //租车赏金
            carImage //车辆图片
            manned //0:可载人 1：不可 2：不限
            rentTime:[
            			{
            				week //求租周几： 1->周一,2-->周二
            				beginTime //求租的开始时间 hh:mm
            				endTime //求租的结束时间
        				}	
            		  ]
            time //创建或修改时间（备注： 显示：1小时前，传值：时间戳）
    		rent //1：发布展示 2：发布未展示
        }
    ]
    ```

## 2. 想租车 publish
- 查看接口：`/publish/list` 

  - 前端请求： 在 `onLoad()` 中自动请求该接口

  - 后台返回：

    ```json
    [
        {
            publishId //帖子 id
            openId //发布者id
            nickName //发布者昵称
            gender //性别 0：女 1：男
            avatarUrl //发布者头像
            area //发布者宿舍区：韵苑
    		areaNum //发布者楼栋：16栋（传数字）
            weixin //微信号
            message //发布信息
            money //租车赏金
            yyyy //求租年月日： yyyy-MM-dd
            week //求租周几： 1->周一,2-->周二
            beginTime //求租的开始时间 hh:mm
            endTime //求租的结束时间 hh:mm
            createTime //创建时间（备注： 显示：1小时前，传值：时间戳）
        },
        {
            //...
        }
    ]
    ```

- 发布：`/publish/add` 

  - 前端请求：

    ```json
    {
        openId //发布者id
        nickName //发布者昵称
        gender //性别 0：女 1：男
        avatarUrl //发布者头像
        area //发布者宿舍区：韵苑
        areaNum //发布者楼栋：16栋（传数字）
        weixin //微信号
        message //发布信息
        money //租车赏金
        yyyy //求租年月日： yyyy-MM-dd
        week //求租周几： 1->周一,2-->周二
        beginTime //求租的开始时间 hh:mm
        endTime //求租的结束时间 hh:mm
    }
    ```

  - 后台返回：

    ```json
    {
        openId
    }
    ```

## 3. 二手车 used

- 页面自动加载二手车信息： `/used/list`

  - 前端请求： 在 `onLoad()` 中自动请求该接口

  - 后台返回：

    ```json
    [
        {
            usedId //帖子id
            openId //发布者id
            nickName //发布者昵称
            gender //性别 0：女 1：男
            avatarUrl //发布者头像
            area //发布者宿舍区：韵苑
    		areaNum //发布者楼栋：16栋（传数字）
            weixin //微信号
            usedImage //二手车图片
            message //发布信息
            money //出手金额 
            createTime //创建时间（备注： 显示：1小时前，传值：时间戳）
        },
        {
            //...
        }
    ]
    ```

## 4. 买修车 repair





## 5. 我的 user

### 1. 用户信息

- 微信授权首次登陆(注册)： `/user/wxRegister` 

  - 前端请求： 

    ```json
    {
    	code //code 码
        nickName //昵称
    	gender //性别 0：女 1：男
    	avatarUrl //头像
    }
    ```

  - 后端返回：

    - 未收到前端传值

      ```json
      {
          openId:-1 //返回 -1 表示出错，提示用户重新授权登录
      }
      ```

    - 收到前端传值并正确获取

      ```json
      {
      	openId //openid + session_key
      	nickName //昵称
      	gender //性别 0：女 1：男
      	avatarUrl //头像
          //其他字段为空
      }
      ```

- 微信登陆时进行身份验证： `/user/wxLogin`

  - 前端请求： 

    ```json
    {
        code //code 码
    }
    ```

  - 后台返回：

    ```json
    {
        openId //与 storage 中的 openId 进行比较，相同则未改变，不同则改变
    }
    ```

- 补全个人信息： `/user/append` 

  - 前端请求： 

    ```json
    {
    	openId //前面的用户唯一 id：openid
    	college //学院：软件学院
    	grade //年级：16级
    	area //宿舍区：韵苑
    	areaNum //楼栋：16栋
    	weixin
        //下面两个字段前端不请求，后台默认为 0，当发布帖子时尽心修改
        //rent //出租信息展示 0：未发布 1：发布展示 2：发布未展示
        //used //二手车信息展示 0：未发布 1：发布未出售 2：发布未出售
    }
    ```

  - 后端返回：

    ```json
    {
    	openId //openid
    	nickName //昵称
    	gender //性别 0：女 1：男
    	avatarUrl //头像
        hustImage //学生证照片（备注：有该照片才能进行操作，否则只能看，不能租车、发布信息等）
    	college //学院：软件学院
    	grade //年级：16级
    	area //宿舍区：韵苑
    	areaNum //楼栋：16栋
    	weixin
        rent //出租信息展示 0：未发布 1：发布展示 2：发布未展示
        used //二手车信息展示 0：未发布 1：发布未出售 2：发布未出售
    }
    ```

- 上传学生证照片：`/user/upload`

  - 前端请求

    ```json
    {
        openId //前面的用户唯一 id：openid
        hustImage //学生证照片（备注：有该照片才能进行操作，否则只能看，不能租车、发布信息等）
    }
    ```

  - 后端返回：

    ```json
    {
        openId //openid
    	nickName //昵称
    	gender //性别 0：女 1：男
    	avatarUrl //头像
        hustImage //学生证照片（备注：有该照片才能进行操作，否则只能看，不能租车、发布信息等）
    	college //学院：软件学院
    	grade //年级：16级
    	area //宿舍区：韵苑
    	areaNum //楼栋：16栋
    	weixin
        rent //出租信息展示 0：未发布 1：发布展示 2：发布未展示
        used //二手车信息展示 0：未发布 1：发布未出售 2：发布未出售
    }
    ```

### 2. 我的出租

- 我的出租： 

  - 查看： `/user/rent/list`

    - 前端直接请求： `onLoad()` 直接加载

      ```json
      {
          openId //用户 id
      }
      ```

    - 后台返回

      ```json
      {
          rent:{
              rentId //帖子id
              openId //发布者id
              nickName //发布者昵称
              gender //性别 0：女 1：男
              avatarUrl //发布者头像
              area //发布者宿舍区：韵苑
              areaNum //发布者楼栋：16栋（传数字）
              weixin //微信号
              message //备注
              money //租车赏金
              manned //能否载人
              rent //出租信息展示 0：未发布 1：发布展示 2：发布未展示
              carImage //车辆图片
              time //创建或修改时间（备注： 显示：1小时前，传值：时间戳）
          },
          rentTime:[
                      {
                          week //求租周几： 周五
                          beginTime //求租的开始时间 hh:mm
                          endTime //求租的结束时间
                      }	
                    ]
      }
      ```

  - 修改或添加：`/user/rent/add`

    - 前端请求： 

      ```json
      {
          rentId //帖子id
          openId //发布者id
          nickName //发布者昵称
          gender //性别 0：女 1：男
          avatarUrl //发布者头像
          area //发布者宿舍区：韵苑
          areaNum //发布者楼栋：16栋（传数字）
          weixin //微信号
          message //备注
          money //租车赏金
          manned //能否载人
          rent //出租信息展示 0：未发布 1：发布展示 2：发布未展示
          carImage //车辆图片
          rentTime:[
                      {
                          week //求租周几： 周五
                          beginTime //求租的开始时间 hh:mm
                          endTime //求租的结束时间
                      }	
                    ]
      }
      ```

    - 后台返回：

      ```json
      {
          rent:{
              rentId //帖子id
              openId //发布者id
              nickName //发布者昵称
              gender //性别 0：女 1：男
              avatarUrl //发布者头像
              area //发布者宿舍区：韵苑
              areaNum //发布者楼栋：16栋（传数字）
              weixin //微信号
              message //备注
              money //租车赏金
              manned //能否载人
              rent //出租信息展示 0：未发布 1：发布展示 2：发布未展示
              carImage //车辆图片
              time //创建或修改时间（备注： 显示：1小时前，传值：时间戳）
          },
          rentTime:[
                      {
                          week //求租周几： 周五
                          beginTime //求租的开始时间 hh:mm
                          endTime //求租的结束时间
                      }	
                    ]
      }
      ```

### 3. 我的求租

- 我的求租： 

  - 查看： `/user/publish/list` 

    - 前端请求：

      ```json
      {
          openId //用户id
      }
      ```

    - 后台返回：

      ```json
      [
          {
      		publishId //求租帖子 id
              openId //发布者id
              nickName //发布者昵称
              gender //性别 0：女 1：男
              avatarUrl //发布者头像
              area //发布者宿舍区：韵苑
              areaNum //发布者楼栋：16栋（传数字）
              weixin //微信号
              message //发布信息
              money //租车赏金
              yyyy //求租年月日： yyyy-MM-dd
              week //求租周几： 1->周一,2-->周二
              beginTime //求租的开始时间 hh:mm
              endTime //求租的结束时间 hh:mm
          }
      ]
      ```

  - 删除： `/user/publish/delete`

    - 前端请求： 

      ```json
      {
          publishId //求租帖子 id
          openId
      }
      ```

    - 后台返回：

      ```json
      //成功
      {
          openId
      }
      //失败
      {
          openId: -1
      }
      ```

### 4. 我的二手车

- 我的二手车： `/user/used` 

  - 查看： `/user/used/list`

    - 前端请求： 

      ```json
      {
          openId //用户id
      }
      ```

    - 后台返回：

      ```json
      {
          usedId //帖子id
          openId //发布者id
          nickName //发布者昵称
          gender //性别 0：女 1：男
          avatarUrl //发布者头像
          area //发布者宿舍区：韵苑
          areaNum //发布者楼栋：16栋（传数字）
          weixin //微信号
          usedImage //二手车图片
          message //发布信息
          used //二手车信息展示 0：未发布 1：发布未出售 2：发布未出售
          money //出手金额 
          createTime //创建时间（备注： 显示：1小时前，传值：时间戳）
      }
      ```

  - 修改： `user/used/change`

    - 前端请求：

      ```json
      {
          usedId //帖子id
          openId //发布者id
          nickName //发布者昵称
          gender //性别 0：女 1：男
          avatarUrl //发布者头像
          area //发布者宿舍区：韵苑
          areaNum //发布者楼栋：16栋（传数字）
          weixin //微信号
          usedImage //二手车图片
          message //发布信息
          //user 表与 used 表
          used //二手车信息展示 0：未发布 1：发布未出售 2：发布已出售
          money //出手金额 
          createTime //创建时间（备注： 显示：1小时前，传值：时间戳）
      }
      ```

    - 后台返回：

      ```json
      {
          usedId //帖子id
          openId //发布者id
          nickName //发布者昵称
          gender //性别 0：女 1：男
          avatarUrl //发布者头像
          area //发布者宿舍区：韵苑
          areaNum //发布者楼栋：16栋（传数字）
          weixin //微信号
          usedImage //二手车图片
          message //发布信息
          //user 表与 used 表
          used //二手车信息展示 0：未发布 1：发布未出售 2：发布未出售
          money //出手金额 
          createTime //创建时间（备注： 显示：1小时前，传值：时间戳）
      }
      ```

## 自动表更新

> 凌晨两点对 used 与 rent 表中与 user 表不同的地方进行自动更新

//需要修改的部分
1. 帖子未按照时间顺序排序
2. 登录校验
3. 
//前端
1. 发布后回到rent页面自动刷新
2. 更新信息后回到me页面自动刷新
3. 帖子时间未处理（->1分钟前）
4. add页面先判断是否已经发过帖子